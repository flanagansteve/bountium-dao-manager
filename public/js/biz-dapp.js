// TODO products don't always come back in the right order - minor issue,
// fixed any reprecussions. just aesthetic now.
// TODO allow owners to set their name in OO
// TODO implement supply step descriptions both here in adding supply step,
// and in contract's addSupplyStep
// TODO replace all "get next order/step" with async fetching
// TODO add more details to display in customer view of store:
  // info about how it is being assured for delivery (ie, guarantees)
  // info about store - their history, reviews, etc
// TODO guide biz owners on assessor setup:
  // using public incents (incorporate registrar contract):
    // level 0: suggest most popular incents
    // level 1: suggest incents based on product key words
  // guide them on deploying their own incent
// TODO cache a user's business address so that they don't have to re-enter it
// TODO darken rest of screen on popups
// TODO move all events listening for catalogue mods to one listener in the
// catalogue overview rather than within each func call

var autobizABI = web3.eth.contract([{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"owners","outputs":[{"name":"name","type":"string"},{"name":"stake","type":"uint256"},{"name":"callsDividend","type":"bool"},{"name":"canDilute","type":"bool"},{"name":"canBestow","type":"bool"},{"name":"canModifyCatalogue","type":"bool"},{"name":"board","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"product","type":"uint256"},{"name":"orderID","type":"uint256"}],"name":"checkOrderStatus","outputs":[{"name":"stepsCompleted","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"biz_name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"catalogue","outputs":[{"name":"name","type":"string"},{"name":"description","type":"string"},{"name":"imageURL","type":"string"},{"name":"forSale","type":"bool"},{"name":"price","type":"uint256"},{"name":"ordersReceived","type":"uint256"},{"name":"supplyChainLength","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"amt","type":"uint256"}],"name":"payDividend","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"isOwner","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"name":"supplyChains","outputs":[{"name":"description","type":"string"},{"name":"incentiviser","type":"address"},{"name":"fee","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"product","type":"uint256"},{"name":"evaluator","type":"address"},{"name":"fee","type":"uint256"}],"name":"addSupplyStep","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"product","type":"uint256"},{"name":"orderID","type":"uint256"}],"name":"paySuppliersForOrder","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalShares","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"equityTaken","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"bestowee","type":"address"},{"name":"which","type":"uint256"}],"name":"bestowPermission","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"sharesToTransfer","type":"uint256"},{"name":"recipient","type":"address"}],"name":"transferShares","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"b32","type":"bytes32"}],"name":"bytes32ToBytes","outputs":[{"name":"b","type":"bytes"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":false,"inputs":[{"name":"product","type":"uint256"},{"name":"step","type":"uint256"}],"name":"paySupplier","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"shares","type":"uint256"},{"name":"recipient","type":"address"}],"name":"giveUnallocatedShares","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"product","type":"uint256"}],"name":"listProduct","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"x","type":"uint256"}],"name":"uintToBytes","outputs":[{"name":"b","type":"bytes"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":false,"inputs":[{"name":"product","type":"uint256"},{"name":"newPrice","type":"uint256"}],"name":"changePrice","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"product","type":"uint256"},{"name":"description_","type":"string"}],"name":"addDescription","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"name":"orders","outputs":[{"name":"complete","type":"bool"},{"name":"suppliersPaid","type":"bool"},{"name":"customerData","type":"string"},{"name":"stepsCompleted","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"name","type":"string"},{"name":"price","type":"uint256"}],"name":"releaseProduct","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"product","type":"uint256"},{"name":"imageURL_","type":"string"}],"name":"addImageUrl","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"name_","type":"string"}],"name":"setMyName","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"product","type":"uint256"},{"name":"customerInfo","type":"string"}],"name":"order","outputs":[{"name":"orderPlaced","type":"bool"},{"name":"delivered","type":"address"},{"name":"orderID","type":"uint256"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"ownersRegistered","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"source","type":"string"}],"name":"stringToBytes","outputs":[{"name":"result","type":"bytes32"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":false,"inputs":[{"name":"stake","type":"uint256"},{"name":"recipient","type":"address"}],"name":"dilute","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"product","type":"uint256"}],"name":"delistProduct","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"name":"equityToSender","type":"uint256"},{"name":"_totalShares","type":"uint256"},{"name":"_name","type":"string"}],"payable":true,"stateMutability":"payable","type":"constructor"},{"payable":false,"stateMutability":"nonpayable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"byWhom","type":"address"}],"name":"OwnershipModified","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"byWhom","type":"address"},{"indexed":false,"name":"productID","type":"uint256"}],"name":"ProductReleased","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"byWhom","type":"address"},{"indexed":false,"name":"productID","type":"uint256"}],"name":"ProductModified","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"productID","type":"uint256"},{"indexed":false,"name":"orderID","type":"uint256"}],"name":"OrderReceived","type":"event"}]);

autobizData = '0x608060405260a060405190810160405280606e8152602001620054e8606e91396008908051906020019062000036929190620002ca565b506040516200555638038062005556833981018060405260608110156200005c57600080fd5b81019080805190602001909291908051906020019092919080516401000000008111156200008957600080fd5b82810190506020810184811115620000a057600080fd5b8151856001820283011164010000000082111715620000be57600080fd5b5050929190505050818311151515620000d657600080fd5b60e0604051908101604052806020604051908101604052806000815250815260200184815260200160011515815260200160011515815260200160011515815260200160011515815260200160011515815250600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008201518160000190805190602001906200018692919062000351565b506020820151816001015560408201518160020160006101000a81548160ff02191690831515021790555060608201518160020160016101000a81548160ff02191690831515021790555060808201518160020160026101000a81548160ff02191690831515021790555060a08201518160020160036101000a81548160ff02191690831515021790555060c08201518160020160046101000a81548160ff021916908315150217905550905050826002819055508160038190555080600090805190602001906200025a929190620002ca565b5060043390806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050505062000400565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200030d57805160ff19168380011785556200033e565b828001600101855582156200033e579182015b828111156200033d57825182559160200191906001019062000320565b5b5090506200034d9190620003d8565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200039457805160ff1916838001178555620003c5565b82800160010185558215620003c5579182015b82811115620003c4578251825591602001919060010190620003a7565b5b509050620003d49190620003d8565b5090565b620003fd91905b80821115620003f9576000816000905550600101620003df565b5090565b90565b6150d880620004106000396000f3fe6080604052600436106101df576000357c0100000000000000000000000000000000000000000000000000000000900480635f833ee311610114578063bc0426ea116100b2578063e041ec0f11610081578063e041ec0f1461119d578063e106fb4b14611218578063eedb09aa146112f4578063f07172cb14611367576101df565b8063bc0426ea14610dd2578063bf188cc414610ebc578063c7857d2714610fa6578063df5d40dc14611086576101df565b806394e8767d116100ee57806394e8767d14610afc578063b3de019c14610bb0578063b51f79e314610c0d578063b94a000f14610cf7576101df565b80635f833ee3146109f15780636d46173f14610a365780638890fe9814610aa9576101df565b806331632a3e116101815780633be477ba1161015b5780633be477ba1461082c5780634283f6351461085757806345579b1f146108ca5780634c0999c71461093d576101df565b806331632a3e1461073f57806335e5a5d0146107bc5780633a98ef3914610801576101df565b80631e0d9560116101bd5780631e0d9560146103df5780632515994e1461058b5780632f54bf6e146105de578063306835ae14610647576101df565b8063022914a7146101ee5780630491b27a146102f65780630f6168161461034f575b3480156101eb57600080fd5b50005b3480156101fa57600080fd5b5061023d6004803603602081101561021157600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506113ba565b60405180806020018881526020018715151515815260200186151515158152602001851515151581526020018415151515815260200183151515158152602001828103825289818151815260200191508051906020019080838360005b838110156102b557808201518184015260208101905061029a565b50505050905090810190601f1680156102e25780820380516001836020036101000a031916815260200191505b509850505050505050505060405180910390f35b34801561030257600080fd5b506103396004803603604081101561031957600080fd5b8101908080359060200190929190803590602001909291905050506114d5565b6040518082815260200191505060405180910390f35b34801561035b57600080fd5b50610364611725565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156103a4578082015181840152602081019050610389565b50505050905090810190601f1680156103d15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156103eb57600080fd5b506104186004803603602081101561040257600080fd5b81019080803590602001909291905050506117c3565b604051808060200180602001806020018815151515815260200187815260200186815260200185815260200184810384528b818151815260200191508051906020019080838360005b8381101561047c578082015181840152602081019050610461565b50505050905090810190601f1680156104a95780820380516001836020036101000a031916815260200191505b5084810383528a818151815260200191508051906020019080838360005b838110156104e25780820151818401526020810190506104c7565b50505050905090810190601f16801561050f5780820380516001836020036101000a031916815260200191505b50848103825289818151815260200191508051906020019080838360005b8381101561054857808201518184015260208101905061052d565b50505050905090810190601f1680156105755780820380516001836020036101000a031916815260200191505b509a505050505050505050505060405180910390f35b34801561059757600080fd5b506105c4600480360360208110156105ae57600080fd5b81019080803590602001909291905050506119e9565b604051808215151515815260200191505060405180910390f35b3480156105ea57600080fd5b5061062d6004803603602081101561060157600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050611c32565b604051808215151515815260200191505060405180910390f35b34801561065357600080fd5b5061068a6004803603604081101561066a57600080fd5b810190808035906020019092919080359060200190929190505050611ccb565b60405180806020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001838152602001828103825285818151815260200191508051906020019080838360005b838110156107025780820151818401526020810190506106e7565b50505050905090810190601f16801561072f5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390f35b34801561074b57600080fd5b506107a26004803603606081101561076257600080fd5b8101908080359060200190929190803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050611dc9565b604051808215151515815260200191505060405180910390f35b3480156107c857600080fd5b506107ff600480360360408110156107df57600080fd5b8101908080359060200190929190803590602001909291905050506121d8565b005b34801561080d57600080fd5b506108166124b3565b6040518082815260200191505060405180910390f35b34801561083857600080fd5b506108416124b9565b6040518082815260200191505060405180910390f35b34801561086357600080fd5b506108b06004803603604081101561087a57600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001909291905050506124bf565b604051808215151515815260200191505060405180910390f35b3480156108d657600080fd5b50610923600480360360408110156108ed57600080fd5b8101908080359060200190929190803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506128d5565b604051808215151515815260200191505060405180910390f35b34801561094957600080fd5b506109766004803603602081101561096057600080fd5b8101908080359060200190929190505050612a8a565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156109b657808201518184015260208101905061099b565b50505050905090810190601f1680156109e35780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156109fd57600080fd5b50610a3460048036036040811015610a1457600080fd5b810190808035906020019092919080359060200190929190505050612ad1565b005b348015610a4257600080fd5b50610a8f60048036036040811015610a5957600080fd5b8101908080359060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050612c90565b604051808215151515815260200191505060405180910390f35b348015610ab557600080fd5b50610ae260048036036020811015610acc57600080fd5b8101908080359060200190929190505050612e27565b604051808215151515815260200191505060405180910390f35b348015610b0857600080fd5b50610b3560048036036020811015610b1f57600080fd5b8101908080359060200190929190505050612fcc565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610b75578082015181840152602081019050610b5a565b50505050905090810190601f168015610ba25780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b348015610bbc57600080fd5b50610bf360048036036040811015610bd357600080fd5b810190808035906020019092919080359060200190929190505050613013565b604051808215151515815260200191505060405180910390f35b348015610c1957600080fd5b50610cdd60048036036040811015610c3057600080fd5b810190808035906020019092919080359060200190640100000000811115610c5757600080fd5b820183602082011115610c6957600080fd5b80359060200191846001830284011164010000000083111715610c8b57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f8201169050808301925050505050505091929192905050506131a5565b604051808215151515815260200191505060405180910390f35b348015610d0357600080fd5b50610d3a60048036036040811015610d1a57600080fd5b810190808035906020019092919080359060200190929190505050613347565b60405180851515151581526020018415151515815260200180602001838152602001828103825284818151815260200191508051906020019080838360005b83811015610d94578082015181840152602081019050610d79565b50505050905090810190601f168015610dc15780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b348015610dde57600080fd5b50610ea260048036036040811015610df557600080fd5b8101908080359060200190640100000000811115610e1257600080fd5b820183602082011115610e2457600080fd5b80359060200191846001830284011164010000000083111715610e4657600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050919291929080359060200190929190505050613445565b604051808215151515815260200191505060405180910390f35b348015610ec857600080fd5b50610f8c60048036036040811015610edf57600080fd5b810190808035906020019092919080359060200190640100000000811115610f0657600080fd5b820183602082011115610f1857600080fd5b80359060200191846001830284011164010000000083111715610f3a57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050919291929050505061382f565b604051808215151515815260200191505060405180910390f35b348015610fb257600080fd5b5061106c60048036036020811015610fc957600080fd5b8101908080359060200190640100000000811115610fe657600080fd5b820183602082011115610ff857600080fd5b8035906020019184600183028401116401000000008311171561101a57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f8201169050808301925050505050505091929192905050506139d1565b604051808215151515815260200191505060405180910390f35b6111496004803603604081101561109c57600080fd5b8101908080359060200190929190803590602001906401000000008111156110c357600080fd5b8201836020820111156110d557600080fd5b803590602001918460018302840111640100000000831117156110f757600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290505050613b31565b60405180841515151581526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390f35b3480156111a957600080fd5b506111d6600480360360208110156111c057600080fd5b810190808035906020019092919050505061479e565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561122457600080fd5b506112de6004803603602081101561123b57600080fd5b810190808035906020019064010000000081111561125857600080fd5b82018360208201111561126a57600080fd5b8035906020019184600183028401116401000000008311171561128c57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f8201169050808301925050505050505091929192905050506147dc565b6040518082815260200191505060405180910390f35b34801561130057600080fd5b5061134d6004803603604081101561131757600080fd5b8101908080359060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050614808565b604051808215151515815260200191505060405180910390f35b34801561137357600080fd5b506113a06004803603602081101561138a57600080fd5b8101908080359060200190929190505050614997565b604051808215151515815260200191505060405180910390f35b6001602052806000526040600020600091509050806000018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114665780601f1061143b57610100808354040283529160200191611466565b820191906000526020600020905b81548152906001019060200180831161144957829003601f168201915b5050505050908060010154908060020160009054906101000a900460ff16908060020160019054906101000a900460ff16908060020160029054906101000a900460ff16908060020160039054906101000a900460ff16908060020160049054906101000a900460ff16905087565b60008060008090505b6005858154811015156114ed57fe5b90600052602060002090600902016007018054905081101561171a5760008060058781548110151561151b57fe5b90600052602060002090600902016007018381548110151561153957fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16637dc0d1d06040518163ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040160206040518083038186803b1580156115c557600080fd5b505afa1580156115d9573d6000803e3d6000fd5b505050506040513d60208110156115ef57600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663c0cca5ef600660008a81526020019081526020016000208881548110151561163b57fe5b90600052602060002090600402016003018581548110151561165957fe5b90600052602060002001546040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050604080518083038186803b1580156116b357600080fd5b505afa1580156116c7573d6000803e3d6000fd5b505050506040513d60408110156116dd57600080fd5b81019080805190602001909291908051906020019092919050505091509150811561170b5783806001019450505b505080806001019150506114de565b508091505092915050565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156117bb5780601f10611790576101008083540402835291602001916117bb565b820191906000526020600020905b81548152906001019060200180831161179e57829003601f168201915b505050505081565b6005818154811015156117d257fe5b9060005260206000209060090201600091509050806000018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561187e5780601f106118535761010080835404028352916020019161187e565b820191906000526020600020905b81548152906001019060200180831161186157829003601f168201915b505050505090806001018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561191c5780601f106118f15761010080835404028352916020019161191c565b820191906000526020600020905b8154815290600101906020018083116118ff57829003601f168201915b505050505090806002018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119ba5780601f1061198f576101008083540402835291602001916119ba565b820191906000526020600020905b81548152906001019060200180831161199d57829003601f168201915b5050505050908060030160009054906101000a900460ff16908060040154908060050154908060060154905087565b6000611a7b6004805480602002602001604051908101604052809291908181526020018280548015611a7057602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311611a26575b505050505033614b3c565b1515611a8657600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160009054906101000a900460ff161515611ae157600080fd5b60025482023073ffffffffffffffffffffffffffffffffffffffff163110151515611b0b57600080fd5b60008090505b600480549050811015611c2857600481815481101515611b2d57fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc60016000600485815481101515611b8457fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206001015485029081150290604051600060405180830381858888f19350505050158015611c1a573d6000803e3d6000fd5b508080600101915050611b11565b5060019050919050565b6000611cc46004805480602002602001604051908101604052809291908181526020018280548015611cb957602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311611c6f575b505050505083614b3c565b9050919050565b600760205281600052604060002081815481101515611ce657fe5b906000526020600020906003020160009150915050806000018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611d935780601f10611d6857610100808354040283529160200191611d93565b820191906000526020600020905b815481529060010190602001808311611d7657829003601f168201915b5050505050908060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060020154905083565b6000611e5b6004805480602002602001604051908101604052809291908181526020018280548015611e5057602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311611e06575b505050505033614b3c565b1515611e6657600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160039054906101000a900460ff161515611ec157600080fd5b600080905060008090505b600586815481101515611edb57fe5b906000526020600020906009020160080180549050811015611f4057600586815481101515611f0657fe5b906000526020600020906009020160080181815481101515611f2457fe5b9060005260206000200154820191508080600101915050611ecc565b50600585815481101515611f5057fe5b90600052602060002090600902016004015483820111151515611f7257600080fd5b600585815481101515611f8157fe5b90600052602060002090600902016007018490806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505060058581548110151561200557fe5b906000526020600020906009020160080183908060018154018082558091505090600182039060005260206000200160009091929091909150555060058581548110151561204f57fe5b90600052602060002090600902016006016000815480929190600101919050555060076000868152602001908152602001600020606060405190810160405280602060405190810160405280600081525081526020018673ffffffffffffffffffffffffffffffffffffffff1681526020018581525090806001815401808255809150509060018203906000526020600020906003020160009091929091909150600082015181600001908051906020019061210c929190614e6d565b5060208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550604082015181600201555050507fea119b5d1c53331dc8e815bae5f38192a8a4660f1959c1c0ed6e21710c0539b13386604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a160019150509392505050565b60008090505b6005838154811015156121ed57fe5b9060005260206000209060090201600701805490508110156123ac57600060058481548110151561221a57fe5b90600052602060002090600902016007018281548110151561223857fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16638df82800600660008781526020019081526020016000208581548110151561229e57fe5b9060005260206000209060040201600301848154811015156122bc57fe5b90600052602060002001546040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b15801561231957600080fd5b505af115801561232d573d6000803e3d6000fd5b505050506040513d602081101561234357600080fd5b81019080805190602001909291905050509050801561239e57600660008581526020019081526020016000208381548110151561237c57fe5b9060005260206000209060040201600201600081548092919060010191905055505b5080806001019150506121de565b5060066000838152602001908152602001600020818154811015156123cd57fe5b906000526020600020906004020160030180549050600660008481526020019081526020016000208281548110151561240257fe5b90600052602060002090600402016002015414156124af576001600660008481526020019081526020016000208281548110151561243c57fe5b906000526020600020906004020160000160006101000a81548160ff0219169083151502179055506001600660008481526020019081526020016000208281548110151561248657fe5b906000526020600020906004020160000160016101000a81548160ff0219169083151502179055505b5050565b60035481565b60025481565b6000612551600480548060200260200160405190810160405280929190818152602001828054801561254657602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190600101908083116124fc575b505050505033614b3c565b151561255c57600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160029054906101000a900460ff1615156125b757600080fd5b612647600480548060200260200160405190810160405280929190818152602001828054801561263c57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190600101908083116125f2575b505050505084614b3c565b151561265257600080fd5b60018214156126ba5760018060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160006101000a81548160ff021916908315150217905550612867565b60028214156127225760018060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160016101000a81548160ff021916908315150217905550612866565b600382141561278a5760018060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160026101000a81548160ff021916908315150217905550612865565b60048214156127f25760018060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160036101000a81548160ff021916908315150217905550612864565b600582141561285a5760018060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160046101000a81548160ff021916908315150217905550612863565b600090506128cf565b5b5b5b5b7fd5d95ef604484497eaeec7fad05891c7932bf086598f9f40e5f40069e1c92fb133604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a1600190505b92915050565b6000612967600480548060200260200160405190810160405280929190818152602001828054801561295c57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311612912575b505050505033614b3c565b151561297257600080fd5b82600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010154101515156129c357600080fd5b82600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160008282540392505081905550612a1d8383614bbb565b7fd5d95ef604484497eaeec7fad05891c7932bf086598f9f40e5f40069e1c92fb133604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a16001905092915050565b606060206040519080825280601f01601f191660200182016040528015612ac05781602001600182028038833980820191505090505b509050816020820152809050919050565b80600583815481101515612ae157fe5b906000526020600020906009020160070180549050111515612b0257600080fd5b60008090505b600583815481101515612b1757fe5b906000526020600020906009020160050154811015612c8b576000600584815481101515612b4157fe5b906000526020600020906009020160070183815481101515612b5f57fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16638df828006006600087815260200190815260200160002084815481101515612bc557fe5b906000526020600020906004020160030185815481101515612be357fe5b90600052602060002001546040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b158015612c4057600080fd5b505af1158015612c54573d6000803e3d6000fd5b505050506040513d6020811015612c6a57600080fd5b81019080805190602001909291905050509050508080600101915050612b08565b505050565b6000612d226004805480602002602001604051908101604052809291908181526020018280548015612d1757602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311612ccd575b505050505033614b3c565b1515612d2d57600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160019054906101000a900460ff161515612d8857600080fd5b60035483600254011015612e1c5782600260008282540192505081905550612db08383614bbb565b7fd5d95ef604484497eaeec7fad05891c7932bf086598f9f40e5f40069e1c92fb133604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a160019050612e21565b600090505b92915050565b6000612eb96004805480602002602001604051908101604052809291908181526020018280548015612eae57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311612e64575b505050505033614b3c565b1515612ec457600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160039054906101000a900460ff161515612f1f57600080fd5b6001600583815481101515612f3057fe5b906000526020600020906009020160030160006101000a81548160ff0219169083151502179055507fea119b5d1c53331dc8e815bae5f38192a8a4660f1959c1c0ed6e21710c0539b13383604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a160019050919050565b606060206040519080825280601f01601f1916602001820160405280156130025781602001600182028038833980820191505090505b509050816020820152809050919050565b60006130a5600480548060200260200160405190810160405280929190818152602001828054801561309a57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311613050575b505050505033614b3c565b15156130b057600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160039054906101000a900460ff16151561310b57600080fd5b8160058481548110151561311b57fe5b9060005260206000209060090201600401819055507fea119b5d1c53331dc8e815bae5f38192a8a4660f1959c1c0ed6e21710c0539b13384604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a16001905092915050565b6000613237600480548060200260200160405190810160405280929190818152602001828054801561322c57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190600101908083116131e2575b505050505033614b3c565b151561324257600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160039054906101000a900460ff16151561329d57600080fd5b816005848154811015156132ad57fe5b906000526020600020906009020160010190805190602001906132d1929190614eed565b507fea119b5d1c53331dc8e815bae5f38192a8a4660f1959c1c0ed6e21710c0539b13384604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a16001905092915050565b60066020528160005260406000208181548110151561336257fe5b9060005260206000209060040201600091509150508060000160009054906101000a900460ff16908060000160019054906101000a900460ff1690806001018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156134355780601f1061340a57610100808354040283529160200191613435565b820191906000526020600020905b81548152906001019060200180831161341857829003601f168201915b5050505050908060020154905084565b60006134d760048054806020026020016040519081016040528092919081815260200182805480156134cc57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311613482575b505050505033614b3c565b15156134e257600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160039054906101000a900460ff16151561353d57600080fd5b6005610120604051908101604052808581526020016040805190810160405280601281526020017f4e6f206465736372697074696f6e207365740000000000000000000000000000815250815260200160088054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156136235780601f106135f857610100808354040283529160200191613623565b820191906000526020600020905b81548152906001019060200180831161360657829003601f168201915b505050505081526020016000151581526020018481526020016000815260200160008152602001600060405190808252806020026020018201604052801561367a5781602001602082028038833980820191505090505b50815260200160006040519080825280602002602001820160405280156136b05781602001602082028038833980820191505090505b508152509080600181540180825580915050906001820390600052602060002090600902016000909192909190915060008201518160000190805190602001906136fb929190614e6d565b506020820151816001019080519060200190613718929190614e6d565b506040820151816002019080519060200190613735929190614e6d565b5060608201518160030160006101000a81548160ff0219169083151502179055506080820151816004015560a0820151816005015560c0820151816006015560e0820151816007019080519060200190613790929190614f6d565b506101008201518160080190805190602001906137ae929190614ff7565b505050507fe0504cc164285e97b36a9f9f435e8141dc6de53f51be25d0b2897704c469f0b233600160058054905003604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a16001905092915050565b60006138c160048054806020026020016040519081016040528092919081815260200182805480156138b657602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001906001019080831161386c575b505050505033614b3c565b15156138cc57600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160039054906101000a900460ff16151561392757600080fd5b8160058481548110151561393757fe5b9060005260206000209060090201600201908051906020019061395b929190614eed565b507fea119b5d1c53331dc8e815bae5f38192a8a4660f1959c1c0ed6e21710c0539b13384604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a16001905092915050565b6000613a636004805480602002602001604051908101604052809291908181526020018280548015613a5857602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311613a0e575b505050505033614b3c565b1515613a6e57600080fd5b81600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000019080519060200190613ac4929190614eed565b507fd5d95ef604484497eaeec7fad05891c7932bf086598f9f40e5f40069e1c92fb133604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a160019050919050565b6000806000600585815481101515613b4557fe5b9060005260206000209060090201600401543410151515613b6557600080fd5b600585815481101515613b7457fe5b906000526020600020906009020160030160009054906101000a900460ff161515613b9e57600080fd5b6006600086815260200190815260200160002060a060405190810160405280600015158152602001600015158152602001868152602001600081526020016000604051908082528060200260200182016040528015613c0c5781602001602082028038833980820191505090505b508152509080600181540180825580915050906001820390600052602060002090600402016000909192909190915060008201518160000160006101000a81548160ff02191690831515021790555060208201518160000160016101000a81548160ff0219169083151502179055506040820151816001019080519060200190613c97929190614e6d565b50606082015181600201556080820151816003019080519060200190613cbe929190614ff7565b505050506000600586815481101515613cd357fe5b90600052602060002090600902016007018054905011156145255760008090505b6001600587815481101515613d0557fe5b906000526020600020906009020160070180549050038110156140fc57600080600588815481101515613d3457fe5b906000526020600020906009020160070183815481101515613d5257fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16637dc0d1d06040518163ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040160206040518083038186803b158015613dde57600080fd5b505afa158015613df2573d6000803e3d6000fd5b505050506040513d6020811015613e0857600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663ef7fa71b613e5d60058b815481101515613e4657fe5b906000526020600020906009020160050154612fcc565b6040518263ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825283818151815260200191508051906020019080838360005b83811015613ec8578082015181840152602081019050613ead565b50505050905090810190601f168015613ef55780820380516001836020036101000a031916815260200191505b50925050506040805180830381600087803b158015613f1357600080fd5b505af1158015613f27573d6000803e3d6000fd5b505050506040513d6040811015613f3d57600080fd5b8101908080519060200190929190805190602001909291905050509150915060066000898152602001908152602001600020600589815481101515613f7e57fe5b906000526020600020906009020160050154815481101515613f9c57fe5b9060005260206000209060040201600301819080600181540180825580915050906001820390600052602060002001600090919290919091505550600588815481101515613fe657fe5b90600052602060002090600902016007018381548110151561400457fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663ca1d209d60058a81548110151561405957fe5b90600052602060002090600902016008018581548110151561407757fe5b9060005260206000200154836040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506000604051808303818588803b1580156140d457600080fd5b505af11580156140e8573d6000803e3d6000fd5b505050505050508080600101915050613cf4565b5060008060058781548110151561410f57fe5b9060005260206000209060090201600701600160058981548110151561413157fe5b9060005260206000209060090201600701805490500381548110151561415357fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16637dc0d1d06040518163ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040160206040518083038186803b1580156141df57600080fd5b505afa1580156141f3573d6000803e3d6000fd5b505050506040513d602081101561420957600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663ef7fa71b614246614241896147dc565b612a8a565b6040518263ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825283818151815260200191508051906020019080838360005b838110156142b1578082015181840152602081019050614296565b50505050905090810190601f1680156142de5780820380516001836020036101000a031916815260200191505b50925050506040805180830381600087803b1580156142fc57600080fd5b505af1158015614310573d6000803e3d6000fd5b505050506040513d604081101561432657600080fd5b810190808051906020019092919080519060200190929190505050915091506006600088815260200190815260200160002060058881548110151561436757fe5b90600052602060002090600902016005015481548110151561438557fe5b90600052602060002090600402016003018190806001815401808255809150509060018203906000526020600020016000909192909190915055506005878154811015156143cf57fe5b906000526020600020906009020160070160016005898154811015156143f157fe5b9060005260206000209060090201600701805490500381548110151561441357fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663ca1d209d60058981548110151561446857fe5b9060005260206000209060090201600801600160058b81548110151561448a57fe5b906000526020600020906009020160080180549050038154811015156144ac57fe5b9060005260206000200154836040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506000604051808303818588803b15801561450957600080fd5b505af115801561451d573d6000803e3d6000fd5b505050505050505b60058581548110151561453457fe5b9060005260206000209060090201600501600081548092919060010191905055507fba9c45564c5c793c4707a33284ffb08787d2ff6f022bb1a8eff0a7fb72b4950985600160058881548110151561458857fe5b90600052602060002090600902016005015403604051808381526020018281526020019250505060405180910390a160006005868154811015156145c857fe5b90600052602060002090600902016007018054905014151561472f5760016005868154811015156145f557fe5b9060005260206000209060090201600701600160058881548110151561461757fe5b9060005260206000209060090201600701805490500381548110151561463957fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16637dc0d1d06040518163ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040160206040518083038186803b1580156146c557600080fd5b505afa1580156146d9573d6000803e3d6000fd5b505050506040513d60208110156146ef57600080fd5b8101908080519060200190929190505050600160058881548110151561471157fe5b90600052602060002090600902016005015403925092509250614797565b60016004600081548110151561474157fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600160058881548110151561477d57fe5b906000526020600020906009020160050154039250925092505b9250925092565b6004818154811015156147ad57fe5b906000526020600020016000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060608290506000815114156147fa576000600102915050614803565b60208301519150505b919050565b600061489a600480548060200260200160405190810160405280929190818152602001828054801561488f57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311614845575b505050505033614b3c565b15156148a557600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160019054906101000a900460ff16151561490057600080fd5b826003600082825401925050819055508260026000828254019250508190555061492a8383614bbb565b7fd5d95ef604484497eaeec7fad05891c7932bf086598f9f40e5f40069e1c92fb133604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a16001905092915050565b6000614a296004805480602002602001604051908101604052809291908181526020018280548015614a1e57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190600101908083116149d4575b505050505033614b3c565b1515614a3457600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020160039054906101000a900460ff161515614a8f57600080fd5b6000600583815481101515614aa057fe5b906000526020600020906009020160030160006101000a81548160ff0219169083151502179055507fea119b5d1c53331dc8e815bae5f38192a8a4660f1959c1c0ed6e21710c0539b13383604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a160019050919050565b600080600090505b8351811015614baf578273ffffffffffffffffffffffffffffffffffffffff168482815181101515614b7257fe5b9060200190602002015173ffffffffffffffffffffffffffffffffffffffff161415614ba2576001915050614bb5565b8080600101915050614b44565b50600090505b92915050565b614c4b6004805480602002602001604051908101604052809291908181526020018280548015614c4057602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311614bf6575b505050505082614b3c565b1515614e185760e0604051908101604052806020604051908101604052806000815250815260200183815260200160001515815260200160001515815260200160001515815260200160001515815260200160001515815250600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000019080519060200190614cff929190614e6d565b506020820151816001015560408201518160020160006101000a81548160ff02191690831515021790555060608201518160020160016101000a81548160ff02191690831515021790555060808201518160020160026101000a81548160ff02191690831515021790555060a08201518160020160036101000a81548160ff02191690831515021790555060c08201518160020160046101000a81548160ff02191690831515021790555090505060048190806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050614e69565b81600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101600082825401925050819055505b5050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10614eae57805160ff1916838001178555614edc565b82800160010185558215614edc579182015b82811115614edb578251825591602001919060010190614ec0565b5b509050614ee99190615044565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10614f2e57805160ff1916838001178555614f5c565b82800160010185558215614f5c579182015b82811115614f5b578251825591602001919060010190614f40565b5b509050614f699190615044565b5090565b828054828255906000526020600020908101928215614fe6579160200282015b82811115614fe55782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555091602001919060010190614f8d565b5b509050614ff39190615069565b5090565b828054828255906000526020600020908101928215615033579160200282015b82811115615032578251825591602001919060010190615017565b5b5090506150409190615044565b5090565b61506691905b8082111561506257600081600090555060010161504a565b5090565b90565b6150a991905b808211156150a557600081816101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555060010161506f565b5090565b9056fea165627a7a72305820fe9550122f770e8e4b213de31bab39c9dc896c3834300628be26cc316701c11d002968747470733a2f2f7777772e6469676974616c636974697a656e2e6c6966652f73697465732f64656661756c742f66696c65732f7374796c65732f6c73745f736d616c6c2f7075626c69632f66656174757265642f323031362d30382f70686f746f5f67616c6c6572792e6a7067';

autobizAddr = null;

autobiz = null;

// Example string-based bounty market at: 0x54a93a193babd89c46ef4f12f7f550a0e1cdc95d
// Example num-based bounty market at: 0x64d083eb98f69555ce813fa2528735e9d09f990a

window.addEventListener('load', async () => {

  document.getElementById("dashboard").innerHTML = "<h1>Bountium is a dapp built on the Ethereum blockchain. You need an Ethereum wallet to use it - we recommend metamask, which you can install <a href = \'https://metamask.io\'>here</a></h1>";

  // check for metamask
  if(typeof web3 !== 'undefined') {
    await ethereum.enable();
    web3 = new Web3(web3.currentProvider);
  } else {
    web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
  }
  try {
    userAccount = web3.eth.accounts[0];
    updateInterface();
    var accountInterval = setInterval(function() {
      if (web3.eth.accounts[0] !== userAccount) {
        userAccount = web3.eth.accounts[0];
        updateInterface();
      }
    }, 100);
  } catch (e) {
    console.error(e);
  }
});

function updateInterface() {
  document.getElementById("workflow-container").innerHTML = "";
  var addr = location.search;
  if (addr.includes("0x")) {
    autobizAddr = addr.substring(addr.indexOf("0x"));
    // presuming its a valid autobiz addr... TODO
    autobiz = autobizABI.at(autobizAddr);
    renderDashboard();
  } else {
    ReactDOM.render(
      React.createElement(Welcome, null, userAccount),
      document.getElementById("dashboard")
    );
  }
}

var Welcome = React.createClass({

  newBiz : function() {
    newBizWorkflow();
  },

  renderDashboard : function () {
    autobizAddr = document.getElementById("autobiz-addr-input").value;
    autobiz = autobizABI.at(autobizAddr);
    renderDashboard();
  },

  render : function() {
    var br = React.createElement("br", {});
    return React.createElement("div", {className:"welcome"},
      React.createElement("h1", {}, "Welcome!"),
      React.createElement("div", {className:"autobiz-addr-form"},
        React.createElement("h4", {}, "Manage my Bountium-powered business"),
        React.createElement("input", {type:"text", id:"autobiz-addr-input", placeholder:"Your Autobiz's address"}),
        br, br,
        React.createElement("button", {id:"autobiz-addr-input-btn", onClick:this.renderDashboard}, "Go!")
      ),
      React.createElement("div", {className:"new-autobiz-form"},
        React.createElement("h4", {}, "Start a Bountium-powered Business"),
        React.createElement("button", {id:"new-biz-btn", onClick:this.newBiz}, "Go!")
      ),
      // TODO
      React.createElement("div", {className:"new-autobiz-form"},
        React.createElement("h4", {}, "Supercharge my existing business with Bountium"),
        React.createElement("button", {id:"new-biz-btn", onClick:function() { alert('coming soon!')}}, "Go!")
      )
    )
  }
})

function newBizWorkflow() {
  if (alertXed)
    document.getElementById("workflow-container").innerHTML = "";
  ReactDOM.render(
    React.createElement(NewBizWorkflow, {}),
    document.getElementById("workflow-container")
  );
}

var NewBizWorkflow = React.createClass({

  getInitialState : function() {
    return {
      xed:false
    }
  },

  x : function() {
    this.setState({xed:true});
    alertXed = true;
  },

  deploy : function() {
    web3.eth.estimateGas(
      {
        data: autobizABI.new.getData(
          document.getElementById("equity-to-sender-input").value,
          document.getElementById("total-shares-input").value,
          document.getElementById("new-biz-name-input").value,
          {data: autobizData}
        )
      },
      (err, res) => {
        autobizABI.new(
          document.getElementById("equity-to-sender-input").value,
          document.getElementById("total-shares-input").value,
          document.getElementById("new-biz-name-input").value,
          {
            from: userAccount,
            data: autobizData,
            gas: Math.floor(res * 1.05)
          },
          (err, res) => {
            if (err)
              console.error(err)
            if (typeof res.address !== 'undefined') {
              alert("Success! Your business has been deployed to: " + res.address);
              autobizAddr = res.address;
              autobiz = autobizABI.at(res.address);
              this.x();
              renderDashboard();
            } else {
              alert("Your business's contract is being deployed to the blockchain - please be patient")
            }
          }
        );
      }
    )
  },

  render : function() {
    if (this.state.xed)
      return React.createElement("div", {});
    var br = React.createElement("br", {})
    var xout = React.createElement("button", {onClick:this.x, className:"popup-x-btn"}, "X");
    var header = React.createElement("h3", {}, "Deploy a new business");
    var newBizDetails = React.createElement("div", {className:"new-biz-details"},
      React.createElement("label", {for:"new-biz-name-input"}, "Name your new business"),
      // TODO pull funny suggestions from somewhere
      React.createElement("input", {type:"text", id:"new-biz-name-input", placeholder:"Steve's Bacon Emporium, Inc"}),
      br,
      React.createElement("label", {for:"equity-to-sender-input"}, "Equity for yourself - leftover shares remain free"),
      React.createElement("input", {type:"number", id:"equity-to-sender-input"}),
      br,
      React.createElement("label", {for:"total-shares-input"}, "Total shares available for equity"),
      React.createElement("input", {type:"number", id:"total-shares-input"})
    );
    return React.createElement("div", {className:"popup"}, xout, header,
      newBizDetails,
      React.createElement("button", {onClick:this.deploy, className:"deploy-biz"}, "Deploy business")
    );
  }
});

function renderDashboard() {
  autobiz.isOwner(userAccount, function(err, res) {
    if (res) {
      document.getElementById("dashboard").innerHTML = "";
      ReactDOM.render(
        React.createElement(Dashboard, null, userAccount),
        document.getElementById("dashboard")
      );
    } else {
      renderNotOwnerError();
    }
  });
}

var Dashboard = React.createClass({

  getInitialState : function() {
    // TODO this renders before these calls run - how to fix?
    var name_ = "your business"
    var owner_ = "Business Owner"
    autobiz.biz_name((err, res) => {
      if (res)
        name_ = res;
    });
    autobiz.owners(userAccount, (err, res) => {
      if (res[0] != "")
        owner_ = res[0];
    });
    return {
      view : true,
      name : name_,
      owner : owner_
    }
  },

  switchView : function() {
    currentView = this.state.view;
    this.setState({view:!currentView});
  },

  render : function() {
    var logo;// = React.createElement("img", {src:"./img/logo.png", href:"./index.html"});
    var welcome = React.createElement("div", null,
      React.createElement("h2", null, "Welcome, " + this.state.owner),
      React.createElement("h3", null, "Here's how " + this.state.name + " is doing today.")
    );
    var co = React.createElement(CatalogueOverview, null);
    var oo = React.createElement(OrgOverview, null);
    var so = React.createElement(StoreOverview, null);
    if (this.state.view)
      return React.createElement("div", null, logo, welcome,
        React.createElement("button", {className:"view-switch",onClick:this.switchView}, "View My Store")
      , React.createElement("div", {className:"my-business"}, co, oo));
    return React.createElement("div", null, logo, welcome,
      React.createElement("button", {className:"view-switch",onClick:this.switchView}, "View My Business")
    , React.createElement("div", {className:"my-business"}, so))
  }

});

var CatalogueOverview = React.createClass({

  getInitialState : function() {
    var catalogue = [];
    // upper lim on how many products to fetch
    var maxProducts = 100;
    for (let i = 0; i < maxProducts; i++) {
      autobiz.catalogue(i, (err, res) => {
        if (err) {
          if(err.message.includes("not a base 16")) {
            // TODO why doesn't this break the loop
            maxProducts = i;
            //console.log("finished getting catalogue at: " + i);
          } else {
            console.error(err)
          }
        } else {
          // Assumes no one is intentionally naming a product ""
          if (res[0] != "") {
            catalogue.push({
              id : i,
              name : res[0],
              description : res[1],
              imageUrl : res[2],
              forSale : res[3],
              price : res[4],
              ordersReceived : res[5],
              supplyChainLength : res[6]
            });
          } else {
            return {
              expanded : false,
              catalogue : catalogue
            }
          }
        }
      });
    }
    // TODO re-order catalogue by product.id
    return {
      expanded : false,
      catalogue : catalogue
    }
  },

  expand : function() {
    this.setState({expanded:true});
  },

  refreshCatalogue : function() {
    var catalogue = [];
    // upper lim on how many products to fetch
    var maxProducts = 100;
    for (let i = 0; i < maxProducts; i++) {
      autobiz.catalogue(i, (err, res) => {
        if (err) {
          if(err.message.includes("not a base 16")) {
            // TODO why doesn't this break the loop
            maxProducts = i;
            //console.log("finished getting catalogue at: " + i);
          } else {
            console.error(err)
          }
        } else {
          // Assumes no one is intentionally naming a product ""
          if (res[0] != "") {
            catalogue.push({
              id : i,
              name : res[0],
              description : res[1],
              imageUrl : res[2],
              forSale : res[3],
              price : res[4],
              ordersReceived : res[5],
              supplyChainLength : res[6]
            });
          } else {
            this.setState({catalogue:catalogue});
            this.setState({expanded:false});
            return;
          }
        }
      });
    }
    this.setState({catalogue:catalogue});
    this.setState({expanded:false});
  },

  collapse : function() {
    this.setState({expanded:false});
  },

  showProductOverview : function(product, func) {
    showProductOverview(product, func)
  },

  mapCatalogue : function(product, key) {
    return React.createElement("div", {className:"product-card", onClick:() => this.showProductOverview(product, this.refreshCatalogue), key:key},
      React.createElement("h5", {}, product.name),
      React.createElement("p", {}, "Price: " + product.price + " wei"),
      React.createElement("p", {}, "" + product.ordersReceived + " orders received"),
      React.createElement("p", {}, "For Sale: " + product.forSale)
    );
  },

  newProduct : function() {
    newProductWorkflow(this.state.catalogue.length, this.refreshCatalogue)
  },

  render : function() {
    if (this.state.expanded)
      return React.createElement("div", {className:"catalogue-feed"},
        React.createElement("h3", null, "Products and Sales"),
        React.createElement("button", {className:"toggle-expand-collapse", onClick:this.collapse}, "-"),
        this.state.catalogue.map(this.mapCatalogue),
        // New product button
        React.createElement("div", {
            className:"product-card",
            id:"new-product-btn",
            onClick:this.newProduct
          },
          React.createElement("h5", {}, "New Product"),
          React.createElement("h5", {}, "+")
        )
      );
    return React.createElement("div", {className:"catalogue-feed"},
      React.createElement("h3", null, "Products and Sales"),
      React.createElement("button", {className:"toggle-expand-collapse", onClick:this.expand}, "+")
    );
  }

});

var alertXed = false;

function showProductOverview(product, func) {
  if (alertXed)
    document.getElementById("workflow-container").innerHTML = "";
  ReactDOM.render(
    React.createElement(ProductOverview,
      {
        refreshCatalogue:func,
        price:product.price,
        description:product.description,
        imageUrl:product.imageUrl,
        productID:product.id,
        ordersReceived:product.ordersReceived,
        supplyChainLength:product.supplyChainLength,
        forSale:product.forSale
      },
      product.name
    ),
    document.getElementById("workflow-container")
  );
}

// TODO on all product state mods, call updateCatalogue() in catalogue react obj
// TODO check for success on each state mod, rather than blindly assuring user
var ProductOverview = React.createClass({

  // TODO show users info abt assesor contracts in the supply chain
  getInitialState : function() {
    return {
      xed:false,
      id:this.props.productID,
      orders:[],
      supplyChain:[]
    }
  },

  x : function() {
    this.setState({xed:true});
    alertXed = true;
  },

  // fetch orders in order of recency, ie, descending order
  anotherOrder : function() {
    // TODO why do we have to click this twice
    var ordersArr = this.state.orders;
    autobiz.orders(this.state.id, this.props.ordersReceived - ordersArr.length - 1, (err, res) => {
      if (res)
        ordersArr.push({
          id : this.props.ordersReceived - ordersArr.length - 1,
          status : res[0],
          paidOut : res[1],
          customerData : res[2]
          // TODO how to represent the array of supply bounties here? a link to it maybe?
        })
    })
    this.setState({orders:ordersArr});
  },

  mapOrders : function(order, key) {
    return React.createElement("tr", {key:key},
      React.createElement("td", {}, "" + order.id),
      React.createElement("td", {}, "" + order.customerData),
      React.createElement("td", {}, "" + order.status),
      React.createElement("td", {},
        React.createElement("button", {onClick:() => this.paySupplier(order.id)}, "Pay")
      )
    )
  },

  paySupplier : function(orderID) {
    autobiz.paySuppliersForOrder(this.state.id, orderID, function(e, r) {
      if(e)
        console.error(e);
      else
        alert("Request sent to contract");
    });
  },

  // fetch supply step in increasing order
  anotherStep : function() {
    // TODO why do we have to click this twice
    var supplyChainArr = this.state.supplyChain;
    autobiz.supplyChains(this.state.id, supplyChainArr.length, (err, res) => {
      if (res)
        supplyChainArr.push({
          description : "Description: " + res[0],
          incentAddress : res[1],
          fee : res[2]
        })
    })
    this.setState({supplyChain:supplyChainArr});
  },

  mapSteps : function(step, key) {
    return React.createElement("tr", {key:key},
      React.createElement("td", {}, key),
      React.createElement("td", {}, step.description),
      React.createElement("td", {}, step.incentAddress),
      React.createElement("td", {}, "" + step.fee)
    )
  },

  addSupplyStep : function() {
    autobiz.addSupplyStep(
      this.props.productID,
      document.getElementById("new-supply-step-addr-input").value,
      document.getElementById("new-supply-step-fee-input").value,
      (err, res) => {
        if (err)
          console.error(err)
        else {
          alert("Request to add this step is on its way!");
          var confirmMod = autobiz.ProductModified((err, res) => {
            if (err)
              console.error(err);
            else
              alert("Successfully added supply step");
              this.props.refreshCatalogue();
              this.x();
          });
        }
      }
    );
  },

  list : function() {
    autobiz.listProduct(this.props.productID, (err, res) => {
      if (err)
        console.error(err)
      else {
        alert("Request to list this product is on its way!");
        var confirmMod = autobiz.ProductModified((err, res) => {
          if (err)
            console.error(err);
          else
            alert("Successfully listed this product");
            this.props.refreshCatalogue();
            this.x();
        })
      }
    });
  },

  delist : function() {
    autobiz.delistProduct(this.props.productID, (err, res) => {
      if (err)
        console.error(err)
      else {
        alert("Request to delist this product is on its way!");
        var confirmMod = autobiz.ProductModified((err, res) => {
          if (err)
            console.error(err);
          else
            alert("Successfully delisted this product");
            this.props.refreshCatalogue();
            this.x();
        })
      }
    });
  },

  changePrice : function() {
    autobiz.changePrice(this.props.productID, document.getElementById("change-price-input").value, (err, res) => {
      if (err)
        console.error(err)
      else {
        alert("Request to change price is on its way!");
        var confirmMod = autobiz.ProductModified((err, res) => {
          if (err)
            console.error(err);
          else
            alert("Successfully changed price");
            this.props.refreshCatalogue();
            this.x();
        })
      }
    });
  },

  addDescription : function() {
    autobiz.addDescription(this.props.productID, document.getElementById("add-description-input").value, (err, res) => {
      if (err)
        console.error(err)
      else {
        alert("Request to update description is on its way!");
        var confirmMod = autobiz.ProductModified((err, res) => {
          if (err)
            console.error(err);
          else
            alert("Successfully updated description");
            this.props.refreshCatalogue();
            this.x();
        })
      }
    });
  },

  addImageUrl : function() {
    // TODO check that the provided url is indeed an img, perhaps look at file type?
    autobiz.addImageUrl(this.props.productID, document.getElementById("add-image-url-input").value, (err, res) => {
      if (err)
        console.error(err)
      else {
        alert("Request to update image url is on its way");
        var confirmMod = autobiz.ProductModified((err, res) => {
          if (err)
            console.error(err);
          else
            alert("Successfully updated image url");
            this.props.refreshCatalogue();
            this.x();
        })
      }
    });
  },

  guideIncentivisers : function() {
    // TODO make this one day suggest popular incentivsiers and let people discover
    // some by keyword
    alert("An incentiviser is the contract to which your business will place bounties for steps in its supply chain. The incentiviser contract is what ensures the supply chain is completed properly - so it is very important to choose carefully! If you'd like an example incentiviser contract, try this one: 0x54a93a193babd89c46ef4f12f7f550a0e1cdc95d. It will reward any response given to it :)");
  },

  render : function() {
    if (this.state.xed)
      return React.createElement("div", {});
    var br = React.createElement("br", {})
    var xout = React.createElement("button", {onClick:this.x, className:"popup-x-btn"}, "X");
    var header = React.createElement("h3", {}, this.props.children);
    var currentProductDetails = React.createElement("div", {className:"current-product-details"},
      React.createElement("img", {src:this.props.imageUrl}),
      React.createElement("p", {}, "Price: " + this.props.price),
      React.createElement("p", {}, "Orders Received: " + this.props.ordersReceived),
      React.createElement("p", {}, "For Sale: " + this.props.forSale),
      React.createElement("p", {}, "Description: " + this.props.description)
    );
    var nextStepButton = React.createElement("p", {className:"all-x-displayed", id:"all-steps-received-note"}, "All steps displayed");
    if (this.props.supplyChainLength - this.state.supplyChain.length > 0)
      nextStepButton = React.createElement("button", {onClick:this.anotherStep}, "Get next step in the supply chain");
    var nextOrderBtn = React.createElement("p", {className:"all-x-displayed", id:"all-orders-received-note"}, "All orders displayed");
    if (this.props.ordersReceived - this.state.orders.length > 0)
      nextOrderBtn = React.createElement("button", {onClick:this.anotherOrder}, "Get next order from contract");
    // TODO only show these ones if user.canModifyCatalogue
    var newSupplyStepForm = React.createElement("div", {className:"product-actions-form", id:"add-supply-step-product-actions-form"},
      React.createElement("h6", {}, "Add a supply step to this product's supply chain"),
      React.createElement("a", {href:"#", id:"incentiviser-guide-click", onClick:this.guideIncentivisers}, "(Help me pick an incentiviser!)"),
      React.createElement("label", {for:"new-supply-step-addr-input"}, "Address of incentiviser for this supply step"),
      React.createElement("input", {type:"text", id:"new-supply-step-addr-input", placeholder:"0x123..."}),
      br,
      React.createElement("label", {for:"change-price-input"}, "Fee your business will pay for this step"),
      React.createElement("input", {type:"number", id:"new-supply-step-fee-input"}),
      br,
      React.createElement("button", {onClick:this.addSupplyStep, className:"product-mod-btn"}, "Add supply step")
    );
    var changePriceForm = React.createElement("div", {className:"product-actions-form"},
      React.createElement("label", {for:"change-price-input"}, "Change the price of this product"),
      React.createElement("input", {type:"number", id:"change-price-input"}),
      br,
      React.createElement("button", {onClick:this.changePrice, className:"product-mod-btn"}, "Change price")
    );
    var changeDescriptForm = React.createElement("div", {className:"product-actions-form"},
      React.createElement("label", {for:"add-description-input"}, "Update the description of this product"),
      React.createElement("input", {type:"text", placeholder:"Product details and assurances go here!", id:"add-description-input"}),
      br,
      React.createElement("button", {onClick:this.addDescription, className:"product-mod-btn"}, "Update description")
    );
    var changeImageUrlForm = React.createElement("div", {className:"product-actions-form"},
      React.createElement("label", {for:"add-image-url-input"}, "Update the image of this product"),
      React.createElement("input", {type:"text", placeholder:"Upload it to a host like imgur or IPFS", id:"add-image-url-input"}),
      br,
      React.createElement("button", {onClick:this.addImageUrl, className:"product-mod-btn"}, "Update image url")
    );
    var listDelist = React.createElement("button", {onClick:this.list, className:"product-mod-btn"}, "List product");
    if (this.props.forSale)
      listDelist = React.createElement("button", {onClick:this.delist, className:"product-mod-btn"}, "Delist product");
    return React.createElement("div", {className:"popup-product-ov"},
      xout, header, currentProductDetails,
      React.createElement("h3", {}, "Supply chain steps:"),
      React.createElement("table", {className:"new-product-supply-steps"},
        React.createElement("tbody", {},
          React.createElement("tr", {},
            React.createElement("th", {}, "Step #"),
            React.createElement("th", {}, "Description"),
            React.createElement("th", {}, "Incentiviser Address"),
            React.createElement("th", {}, "Fee")
          ),
          this.state.supplyChain.map(this.mapSteps)
        )
      ),
      nextStepButton,
      React.createElement("h3", {}, "Orders received:"),
      React.createElement("table", {className:"new-product-supply-steps"},
        React.createElement("tbody", {},
          React.createElement("tr", {},
            React.createElement("th", {}, "Order ID"),
            React.createElement("th", {}, "Customer Data"),
            React.createElement("th", {}, "Completed?"),
            React.createElement("th", {}, "Pay Suppliers")
          ),
          this.state.orders.map(this.mapOrders)
        )
      ),
      nextOrderBtn,
      newSupplyStepForm, br,
      changePriceForm, br,
      changeDescriptForm, br,
      changeImageUrlForm, br,
      listDelist
    );
  }
})

function newProductWorkflow(newID, func) {
  if (alertXed)
    document.getElementById("workflow-container").innerHTML = "";
  ReactDOM.render(
    React.createElement(NewProductWorkflow, {newID:newID, refreshCatalogue:func}),
    document.getElementById("workflow-container")
  );
}

var NewProductWorkflow = React.createClass({
  getInitialState : function() {
    return {
      xed:false,
      supplySteps:[]
    }
  },

  x : function() {
    this.setState({xed:true});
    alertXed = true;
  },

  mapInputtedSteps : function (step, key) {
    return React.createElement("tr", {key:key},
      React.createElement("td", {}, key),
      React.createElement("td", {}, step.assessorAddr),
      React.createElement("td", {}, step.fee)
    )
  },

  addStep : function() {
    var supplyStepsArr = this.state.supplySteps;
    supplyStepsArr.push({
      assessorAddr:document.getElementById("new-step-assessor-addr").value,
      fee:document.getElementById("new-step-fee").value
    });
    this.setState({supplySteps:supplyStepsArr});
  },

  guideIncentivisers : function() {
    // TODO make this one day suggest popular incentivsiers and let people discover
    // some by keyword
    alert("An incentiviser is the contract to which your business will place bounties for steps in its supply chain. The incentiviser contract is what ensures the supply chain is completed properly - so it is very important to choose carefully! If you'd like an example incentiviser contract, try this one: 0x54a93a193babd89c46ef4f12f7f550a0e1cdc95d. It will reward any response given to it :)");
  },

  deploy : function() {
    // Deploying means:
      // 1. autobiz.releaseProduct(name, price)
      // 2. autobiz.addSupplyStep() for each in table
      // 3. if (checkbox) autobiz.listProduct()
    autobiz.releaseProduct(
      document.getElementById("new-product-name").value,
      document.getElementById("new-product-price").value,
      (err, res) => {
        if (err)
          console.error(err)
        if (typeof res !== 'undefined') {
          alert("Your product is being sent to the contract now.");
          // Note: the new product's productID should be equal to the number of products in the catalogue
          var productReleased = autobiz.ProductReleased((err, res) => {
            // ignoring errors for now
            // if tx was confirmed:
            if (res) {
              // confirmed, so batch all the product mods and send as tx
              if (this.state.supplySteps.length > 0 || document.getElementById("new-product-list").checked || document.getElementById("new-product-description").value || document.getElementById("new-product-image-url").value) {
                // alert success
                alert("Your product has been received by the contract - sending initial configurations now");
                var productMods = web3.createBatch();
                for (let i = 0; i < this.state.supplySteps.length; i++)
                  productMods.add(
                    autobiz.addSupplyStep(this.props.newID,
                      this.state.supplySteps[i].assessorAddr,
                      this.state.supplySteps[i].fee,
                      (err_supply_step, res_supply_step) => {
                        if (err_supply_step)
                          console.error(err_supply_step)
                      }
                    )
                  );
                if(document.getElementById("new-product-list").checked)
                  productMods.add(
                    autobiz.listProduct(this.props.newID, (err_listing, res_listing) => {
                      if (err_listing)
                        console.error(err_listing);
                    })
                  );
                if(document.getElementById("new-product-description").value != "")
                  productMods.add(
                    autobiz.addDescription(this.props.newID, document.getElementById("new-product-description").value, (err_adding_description, res_adding_description) => {
                      if (err_adding_description)
                        console.error(err_adding_description);
                    })
                  );
                if(document.getElementById("new-product-image-url").value != "")
                  productMods.add(
                    autobiz.addImageUrl(this.props.newID, document.getElementById("new-product-image-url").value, (err_adding_img, res_adding_img) => {
                      if (err_adding_img)
                        console.error(err_adding_img);
                    })
                  );
                var settingsInitialised = autobiz.ProductModified((err_listener, res_listener) => {
                  if (err_listener)
                    console.error(err_listener)
                  else if (res_listener) {
                    // TODO why don't this exec
                    alert('Success! Your product has been released with its initialised settings.')
                    this.props.refreshCatalogue();
                    this.x();
                  }
                });
                productMods.execute();
              }
              else {
                // confirmed, no more to do
                alert('Success! Your product has been released.')
                this.props.refreshCatalogue();
                this.x();
              }
            }
            // otherwise, unconfirmed or can't access confirmation
            else {
              alert("We weren't able to confirm the tx, and therefore weren't able to automatically set your initialised supply chain and listing preference - Once Metamask confirms the tx, refresh, then click on the product's card in the catalogue to do so manually")
              this.x();
            }
          });
        }
      }
    )
  },

  render : function() {
    if (this.state.xed)
      return React.createElement("div", {});
    var br = React.createElement("br", {})
    var xout = React.createElement("button", {onClick:this.x, className:"popup-x-btn"}, "X");
    var header = React.createElement("h3", {}, "Release a new product");
    var newProductDetails = React.createElement("div", {className:"new-product-details"},
      React.createElement("label", {for:"new-product-name"}, "Name the new product"),
      // TODO pull funny name suggestions from somewhere
      React.createElement("input", {type:"text", id:"new-product-name", placeholder:"Baconator 5000!"}),
      br,
      React.createElement("label", {for:"new-product-price"}, "Price, in wei"),
      React.createElement("input", {type:"number", id:"new-product-price"})
    );
    var newStepInput = React.createElement("div", {className:"product-actions-form"},
      React.createElement("h5", {}, "Add a new step:"),
      React.createElement("a", {href:"#", id:"incentiviser-guide-click", onClick:this.guideIncentivisers}, "(Help me pick an incentiviser!)"),
      React.createElement("label", {for:"new-step-assessor-addr"}, "Address of incentiviser for this step: "),
      React.createElement("input", {type:"text", id:"new-step-assessor-addr", placeholder:"Address of incentiviser for this supply step"}),
      br,
      React.createElement("label", {for:"new-step-fee"}, "Amount to pay for this step:"),
      React.createElement("input", {type:"number", id:"new-step-fee"}),
      br,
      React.createElement("button", {onClick:this.addStep, className:"product-mod-btn"}, "Add step")
    );
    var changeDescriptForm = React.createElement("div", {className:"product-actions-form"},
      React.createElement("label", {for:"new-product-description"}, "Add a description of this product"),
      React.createElement("input", {type:"text", placeholder:"Product details and assurances go here!", id:"new-product-description"}),
    );
    var changeImageUrlForm = React.createElement("div", {className:"product-actions-form"},
      React.createElement("label", {for:"new-product-image-url"}, "Add an image for this product"),
      React.createElement("input", {type:"text", placeholder:"Upload it to a host like imgur or IPFS", id:"new-product-image-url"}),
    );
    var deploy = React.createElement("button", {onClick:this.deploy, className:"deploy-product"}, "Deploy product");
    return React.createElement("div", {className:"popup"}, xout, header,
      newProductDetails,
      React.createElement("h5", {id:"option-header"}, "Optional initalised configurations:"),
      changeDescriptForm,
      changeImageUrlForm,
      React.createElement("h3", {}, "Steps in supply chain:"),
      React.createElement("table", {className:"new-product-supply-steps"},
        React.createElement("tbody", {},
          React.createElement("tr", {},
            React.createElement("th", {}, "Step #"),
            React.createElement("th", {}, "Assessor Address"),
            React.createElement("th", {}, "Fee")
          ),
          this.state.supplySteps.map(this.mapInputtedSteps)
        )
      ),
      newStepInput, br,
      React.createElement("div", {},
        React.createElement("label", {for:"new-product-list"}, "List immediately"),
        React.createElement("input", {type:"checkbox", id:"new-product-list"})
      ), deploy
    );
  }
});

var StoreOverview = React.createClass({

  getInitialState : function() {
    var bizName_ = "anonymous business";
    autobiz.biz_name(function(err, res) {
      if (res!="")
        bizName_ = res;
    });
    var orderReceived = autobiz.OrderReceived((err, res) => {
      if (err)
        console.error(err)
      if (typeof res.args.productID !== 'undefined')
        alert("Success! Your order has been confirmed for product with ID: " + res.args.productID + " with orderID " + res.args.orderID + ". Save these somewhere in order to check your order's status later.");
    });
    var catalogue = [];
    // upper lim on how many products to fetch
    var maxProducts = 100;
    for (let i = 0; i < maxProducts; i++) {
      autobiz.catalogue(i, (err, res) => {
        if (err) {
          if(err.message.includes("not a base 16")) {
            return {
              expanded : false,
              catalogue : catalogue,
              bizName : bizName_
            }
          } else {
            console.error(err)
          }
        } else {
          // Assumes no one is intentionally naming a product ""
          if (res[0] != "") {
            if (res[3])
              catalogue.push({
                name : res[0],
                description : res[1],
                imageUrl : res[2],
                forSale : res[3],
                price : res[4],
                ordersReceived : res[5],
                supplyChainLength : res[6]
              });
          } else {
            return {
              expanded : false,
              catalogue : catalogue,
              bizName : bizName_
            }
          }
        }
      });
    }
    return {
      expanded : false,
      catalogue : catalogue,
      bizName : bizName_
    }
  },

  expand : function() {
    this.setState({expanded:true});
  },

  collapse : function() {
    this.setState({expanded:false});
  },

  order : function(productID) {
    autobiz.order(productID, document.getElementById("customer-info-input-" + productID).value,
      {from:userAccount, value:this.state.catalogue[productID].price},
      function(err, res) {
        if (err) {
          console.error(err)
        } else {
          // TODO why don't this run on tx confirm :(((
          alert("Your order has been sent and is awaiting confirmation");
        }
      }
    );
  },

  mapCatalogue : function(product, key) {
    return React.createElement("div", {className:"product-card", key:key},
      React.createElement("h5", {}, product.name),
      React.createElement("img", {className:"product-card-img", src:product.imageUrl}),
      React.createElement("p", {}, product.description),
      React.createElement("p", {}, "Price: " + product.price + " wei"),
      React.createElement("label", {for:"customer-info-input-" + key}, "Input your delivery information"),
      React.createElement("input", {type:"text", id:"customer-info-input-" + key, placeholder:"A email or physical address, most likely"}),
      React.createElement("button", {className:"order-btn", onClick:() => this.order(key)}, "Order")
    );
  },

  lookupOrder : function() {
    autobiz.checkOrderStatus(
      document.getElementById("product-id-input").value,
      document.getElementById("order-id-input").value,
      function(err, res) {
        if (err)
          console.error(err)
        else
          // TODO way to let owner make note of progress? or have autobiz auto-mark
          // steps in the supply chain as completed, so we can say "3/5 steps done"
          // or "in delivery" for example?
          autobiz.catalogue(document.getElementById("product-id-input").value,
            function(err1, res1) {
              if (err1)
                console.error(err1);
              else {
                if (res1[6] == res)
                  alert("Your order has been completed");
                else if (res1[6] == res + 1)
                  alert("Your order is manufactured, and being delivered to you!");
                else
                  alert(res + " out of " + res1[6] + " steps have been finished in completing your order");
              }
            }
          );
      }
    );
  },

  render : function() {
    var link = location.href;
    if (!link.includes(autobizAddr))
      if (link.includes("?0x"))
        link = link.substring(0, link.indexOf("?")) + "?" + autobizAddr;
      else
        link += "?" + autobizAddr;
    link = link.replace("biz", "shop");
    var howToShare = React.createElement("div", {className:"how-to-share"},
      React.createElement("p", {}, "Here's the link to your store for customers to buy from:"),
      React.createElement("p", {},
        React.createElement("a", {href:link}, link)
      )
    );
    var catalogueList = React.createElement("p", {}, "This business has not listed any products for sale!");
    var orderChecker = React.createElement("div", {className:"order-checker"},
      React.createElement("h4", {}, "Check an order's status"),
      React.createElement("label", {for:"product-id-input"}, "Input the product and order id"),
      React.createElement("input", {type:"number", id:"product-id-input"}),
      React.createElement("input", {type:"number", id:"order-id-input"}),
      React.createElement("button", {onClick:this.lookupOrder}, "Lookup")
    );
    if (this.state.catalogue.length >= 0)
      catalogueList = this.state.catalogue.map(this.mapCatalogue);
    if (this.state.expanded)
      return React.createElement("div", {className:"store-overview"}, howToShare,
        React.createElement("div", {className:"catalogue-feed"},
          React.createElement("h3", null, "Welcome to the store of: " + this.state.bizName),
          orderChecker, React.createElement("br", {}),
          React.createElement("h3", null, "Products Available"),
          React.createElement("button", {className:"toggle-expand-collapse", onClick:this.collapse}, "-"),
          catalogueList
        )
      );
    return React.createElement("div", {className:"store-overview"}, howToShare,
      React.createElement("div", {className:"catalogue-feed"},
        React.createElement("h3", null, "Welcome to the store of: " + this.state.bizName),
        orderChecker, React.createElement("br", {}),
        React.createElement("h3", null, "Products Available"),
        React.createElement("button", {className:"toggle-expand-collapse", onClick:this.expand}, "+")
      )
    );
  }

});

var OrgOverview = React.createClass({

  getInitialState : function() {
    var modListener = autobiz.OwnershipModified((err, res) => {
      if (res) {
        // TODO this presumes other owners won't modify the org while this user is online
        alert("Ownership changes confirmed.");
        this.refreshOrg();
      }
    })
    var owners_ = [];
    // TODO how to get total number of owners?? presuming ten. perhaps a button
    // to get ten at a time?
    var maxOwners = 10;
    // TODO can i speed this up? delays load.
    for (let i = 0; i < maxOwners; i++)
      autobiz.ownersRegistered(i, (err, res) => {
        if (err)
          if(err.message.includes("not a base 16"))
            // break
            return {
              shares : 0,
              totalShares : 0,
              dividend : false,
              dilute : false,
              bestow : false,
              modifyCatalogue : false,
              board : false,
              owners : owners_,
              expanded : false,
              orgFunds : 0
            }
          else
            console.error(err);
        owners_.push(res);
      });
    return {
      shares : 0,
      totalShares : 0,
      dividend : false,
      dilute : false,
      bestow : false,
      modifyCatalogue : false,
      board : false,
      owners : owners_,
      expanded : false,
      orgFunds : 0
    }
  },

  refreshOrg : function() {
    var owners_ = [];
    // TODO how to get total number of owners?? presuming ten. perhaps a button
    // to get ten at a time?
    var maxOwners = 10;
    for (let i = 0; i < maxOwners; i++)
      autobiz.ownersRegistered(i, (err, res) => {
        if (err)
          if(err.message.includes("not a base 16"))
            // break
            return {
              shares : 0,
              totalShares : 0,
              dividend : false,
              dilute : false,
              bestow : false,
              modifyCatalogue : false,
              board : false,
              owners : owners_,
              expanded : false,
              orgFunds : 0
            }
          else
            console.error(err);
        owners_.push(res);
      });
    this.setState({owners:owners_});
    this.setState({expanded:false})
  },

  expand : function() {
    autobiz.owners(userAccount, (err, res) => {
      if(err)
        console.error(err)
      if (res) {
        this.setState({shares : res[1]});
        this.setState({dividend : res[2]});
        this.setState({dilute : res[3]});
        this.setState({bestow : res[4]});
        this.setState({modifyCatalogue : res[5]});
        this.setState({board : res[6]});
      }
    });
    autobiz.totalShares( (err, res) => {
      if (err)
        console.error(err);
      this.setState({totalShares : res.c[0]});
    });
    web3.eth.getBalance(autobizAddr, (err, res) => {
      if (err)
        console.error(err);
      this.setState({orgFunds:res});
    })
    this.setState({expanded:true});
  },

  collapse : function() {
    this.setState({expanded:false});
  },

  callDividend : function() {
    autobiz.payDividend(document.getElementById("dividend-amt-input").value, (err, res) => {
      if (err)
        console.error(err);
      alert("Your dividend of " +
        (document.getElementById("dividend-amt-input").value * this.state.shares)
        + " wei is on its way!"
      );
    });
  },

  fundBiz : function() {
    web3.eth.sendTransaction(
      {
        from : userAccount,
        to : autobizAddr,
        value : document.getElementById("org-funding-amt-input").value
      }, function(err, res) {
        if (err)
          console.error(err)
        alert("Your funding is on its way - Metamask will notify you when the tx is confirmed. You will then be able to refresh to see the changes reflected here");
      }
    )
  },

  transfer : function() {
    autobiz.transferShares(
      document.getElementById("transfer-shares-amt-input").value,
      document.getElementById("transfer-shares-addr-input").value,
      function(err, res) {
        if(err)
          console.error(err)
        alert("Your request is on its way!")
      }
    );
  },

  giveUnallocated : function() {
    autobiz.giveUnallocatedShares(
      document.getElementById("give-shares-amt-input").value,
      document.getElementById("give-shares-addr-input").value,
      function(err, res) {
        if(err)
          console.error(err)
        alert("Your request is on its way!")
      }
    );
  },

  dilute : function() {
    autobiz.dilute(
      document.getElementById("dilute-shares-amt-input").value,
      document.getElementById("dilute-shares-addr-input").value,
      function(err, res) {
        if(err)
          console.error(err)
        alert("Your request is on its way!")
      }
    );
  },

  givePermission : function() {
    autobiz.bestowPermission(
      document.getElementById("bestow-permission-addr-input").value,
      document.getElementById("bestow-permission-id-input").value,
      function(err, res) {
        if(err)
          console.error(err)
        alert("Your request is on its way!")
      }
    );
  },

  mapOwners : function(owner, key) {
    // TODO have each addr link to popup with info about their ownership role
    // currently just links to etherscan
    if (owner != "0x")
      return React.createElement("div", {key:key},
        React.createElement("a",
          {
            className:"owner-link",
            href:"https://ropsten.etherscan.io/address/" + owner
          },
          owner
        ),
        React.createElement("br", {})
      );
    return null;
  },

  render : function() {
    var br = React.createElement("br", {});
    /*
    shares : 0,
    totalShares : 0,
    dividend : false,
    dilute : false,
    bestow : false,
    modifyCatalogue : false,
    board : false,
    owners : owners_,
    expanded : false,
    orgFunds : 0
    */
    var giveUS, dilute, bestow = null;
    if (this.state.dilute) {
      giveUS = React.createElement("div", {},
        React.createElement("h5", {}, "Give unallocated shares:"),
        React.createElement("div", {className:"org-mgmt-form"},
          React.createElement("label", {for:"give-shares-amt-input"}, "Amount of shares to give: "),
          React.createElement("input", {type:"number", id:"give-shares-amt-input"}),
          br, br,
          React.createElement("label", {for:"give-shares-addr-input"}, "Address of new owner: "),
          React.createElement("input", {type:"text", id:"give-shares-addr-input"}),
          br, br,
          React.createElement("button", {onClick:this.giveUnallocated}, "Give shares")
        )
      );
      dilute = React.createElement("div", {},
        React.createElement("h5", {}, "Give new shares, diluting current owners' stakes:"),
        React.createElement("div", {className:"org-mgmt-form"},
          React.createElement("label", {for:"dilute-shares-amt-input"}, "Amount of shares to create and give: "),
          React.createElement("input", {type:"number", id:"dilute-shares-amt-input"}),
          br, br,
          React.createElement("label", {for:"dilute-shares-addr-input"}, "Address of new owner: "),
          React.createElement("input", {type:"text", id:"dilute-shares-addr-input"}),
          br, br,
          React.createElement("button", {onClick:this.dilute}, "Create and give shares")
        )
      );
      bestow = React.createElement("div", {},
        React.createElement("h5", {}, "Bestow permissioned roles to a co-owner:"),
        React.createElement("p", {}, "Role IDs are assigned as follows:"),
        React.createElement("ul", {}, "1. can call dividend"),
        React.createElement("ul", {}, "2. can dilute shares"),
        React.createElement("ul", {}, "3. can bestow permissions to others"),
        React.createElement("ul", {}, "4. can modify the catalogue"),
        React.createElement("ul", {}, "5. is a board member"),
        React.createElement("div", {className:"org-mgmt-form"},
          React.createElement("label", {for:"give-permission-id-input"}, "Role ID: "),
          React.createElement("input", {type:"number", id:"give-permission-id-input"}),
          br, br,
          React.createElement("label", {for:"give-permission-addr-input"}, "Address of bestowee: "),
          React.createElement("input", {type:"text", id:"give-permission-addr-input"}),
          br, br,
          React.createElement("button", {onClick:this.givePermission}, "Give permission")
        )
      );
    }
    if (!this.state.expanded)
      return React.createElement("div", {className:"organisation-mgr"},
        React.createElement("h3", null, "Your Organisation"),
        React.createElement("button", {className:"toggle-expand-collapse", onClick:this.expand}, "+")
      );
    var ownership = React.createElement("div", {className:"org-mgmt-section"},
      React.createElement("h4", null, "Ownership and shares"),
      React.createElement("p", null,
          "Your stake: " + this.state.shares + " shares of "
          + this.state.totalShares + " total shares, for a stake of "
          + ((this.state.shares / this.state.totalShares) * 100) + "%"
      ),
      React.createElement("p", {}, "Owners:"),
      this.state.owners.map(this.mapOwners),
      React.createElement("h5", {}, "Transfer your shares:"),
      React.createElement("div", {className:"org-mgmt-form"},
        React.createElement("label", {for:"transfer-shares-amt-input"}, "Amount of shares to transfer: "),
        React.createElement("input", {type:"number", id:"transfer-shares-amt-input"}),
        br, br,
        React.createElement("label", {for:"transfer-shares-addr-input"}, "Address of new owner: "),
        React.createElement("input", {type:"text", id:"transfer-shares-addr-input"}),
        br, br,
        React.createElement("button", {onClick:this.transfer}, "Transfer shares")
      ),
      giveUS,
      dilute,
      bestow
    );
    var orgFundsDiv = React.createElement("div", {className:"org-mgmt-section"},
      React.createElement("h4", null, "Organisation funds"),
      React.createElement("p", null, "Current organisation balance: " + this.state.orgFunds + " wei"),
      React.createElement("h5", {}, "Send funds to the organisation"),
      React.createElement("div", {className:"org-mgmt-form"},
        React.createElement("label", {for:"org-funding-amt-input"}, "Amount to send organisation, in wei: "),
        React.createElement("input", {type:"number", id:"org-funding-amt-input"}),
        br, br,
        React.createElement("button", {onClick:this.fundBiz}, "Send funds")
      )
    );
    var dividendCall = null;
    if (this.state.dividend)
      dividendCall = React.createElement("div", {className:"org-mgmt-section"},
        React.createElement("h4", null, "Dividends"),
        React.createElement("h5", null, "Call for a new dividend"),
        React.createElement("div", {className:"org-mgmt-form"},
          React.createElement("label", {for:"dividend-amt-input"}, "Wei per share: "),
          React.createElement("input", {type:"number", id:"dividend-amt-input"}),
          br, br,
          React.createElement("button", {onClick:this.callDividend}, "Call for a dividend")
        )
      );
    return React.createElement("div", {className:"organisation-mgr"},
      React.createElement("h3", null, "Your Organisation"),
      React.createElement("button", {className:"toggle-expand-collapse", onClick:this.collapse}, "-"),
      React.createElement("div", {className:"org-info-and-actions"},
        ownership, br, br,
        orgFundsDiv, br, br,
        dividendCall
      )
    );
  }

});

function renderNotOwnerError() {
  if (alertXed)
    document.getElementById("workflow-container").innerHTML = "";
  ReactDOM.render(
    React.createElement(Welcome, {}, userAccount),
    document.getElementById("dashboard")
  );
  ReactDOM.render(
    React.createElement(NotOwnerError, {}, "Error"),
    document.getElementById("workflow-container")
  );
};

var NotOwnerError = React.createClass({

  getInitialState : function() {
    return {
      xed:false
    }
  },

  x : function() {
    this.setState({xed:true});
    alertXed = true;
  },

  render : function() {
    if (this.state.xed)
      return React.createElement("div", {});
    var br = React.createElement("br", {});
    var xout = React.createElement("button", {onClick:this.x, className:"popup-x-btn"}, "X");
    var header = React.createElement("h3", {}, this.props.children);
    var shopLink = location.href.replace("biz", "shop");
    if (!shopLink.includes(autobizAddr))
      if (shopLink.includes("?0x"))
        shopLink = shopLink.substring(0, shopLink.indexOf("?")) + "?" + autobizAddr;
      else
        shopLink += "?" + autobizAddr;
    return React.createElement("div", {className:"popup"},
      xout, header,
      React.createElement("h5", {}, "You are not registered as an owner of this autobiz"),
      br,
      React.createElement("p", {}, "If you meant to shop at this autobiz, follow this link: " + shopLink),
      br,
      React.createElement("p", {}, "Or, try re-typing the address of your autobiz - maybe you have the wrong one")
    );
  }
})
